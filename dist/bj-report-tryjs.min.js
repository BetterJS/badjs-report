var BJ_REPORT=function(a){if(a.BJ_REPORT)return a.BJ_REPORT;var b=[],c={},d={id:0,uin:0,url:"",combo:1,ext:null,level:4,ignore:[],random:1,delay:1e3,submit:null,repeat:1},e=function(a,b){return Object.prototype.toString.call(a)==="[object "+(b||"Object")+"]"},f=function(a){var b=typeof a;return"object"===b&&!!a},g=function(a){return null===a?!0:e(a,"Number")?!1:!a},h=a.onerror;a.onerror=function(b,c,d,f,g){var i=b;g&&g.stack&&(i=j(g)),e(i,"Event")&&(i+=i.type?"--"+i.type+"--"+(i.target?i.target.tagName+"::"+i.target.src:""):""),r.push({msg:i,target:c,rowNum:d,colNum:f}),q(),h&&h.apply(a,arguments)};var i=function(a){try{if(a.stack){var b=a.stack.match("https?://[^\n]+");b=b?b[0]:"";var c=b.match(":(\\d+):(\\d+)");c||(c=[0,0,0]);var d=j(a);return{msg:d,rowNum:c[1],colNum:c[2],target:b.replace(c[0],"")}}return a.name&&a.message&&a.description?{msg:JSON.stringify(a)}:a}catch(e){return a}},j=function(a){var b=a.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),c=a.toString();return b.indexOf(c)<0&&(b=c+"@"+b),b},k=function(a,b){var c=[],e=[],h=[];if(f(a)){a.level=a.level||d.level;for(var i in a){var j=a[i];if(!g(j)){if(f(j))try{j=JSON.stringify(j)}catch(k){j="[BJ_REPORT detect value stringify error] "+k.toString()}h.push(i+":"+j),c.push(i+"="+encodeURIComponent(j)),e.push(i+"["+b+"]="+encodeURIComponent(j))}}}return[e.join("&"),h.join(","),c.join("&")]},l=[],m=function(a){if(d.submit)d.submit(a);else{var b=new Image;l.push(b),b.src=a}},n=function(a){if(!f(a))return!0;var b=a.msg,e=c[b]=(parseInt(c[b],10)||0)+1;return e>d.repeat},o=[],p=0,q=function(a){if(d.report){for(;b.length;){var c=!1,f=b.shift();if(!n(f)){var g=k(f,o.length);if(e(d.ignore,"Array"))for(var h=0,i=d.ignore.length;i>h;h++){var j=d.ignore[h];if(e(j,"RegExp")&&j.test(g[1])||e(j,"Function")&&j(f,g[1])){c=!0;break}}c||(d.combo?o.push(g[0]):m(d.report+g[2]+"&_t="+ +new Date),d.onReport&&d.onReport(d.id,f))}}var l=o.length;if(l){var q=function(){clearTimeout(p),m(d.report+o.join("&")+"&count="+o.length+"&_t="+ +new Date),p=0,o=[]};a?q():p||(p=setTimeout(q,d.delay))}}},r=a.BJ_REPORT={push:function(a){if(Math.random()>=d.random)return r;var c=f(a)?i(a):{msg:a};return d.ext&&!c.ext&&(c.ext=d.ext),b.push(c),q(),r},report:function(a){return a&&r.push(a),q(!0),r},info:function(a){return a?(f(a)?a.level=2:a={msg:a,level:2},r.push(a),r):r},debug:function(a){return a?(f(a)?a.level=1:a={msg:a,level:1},r.push(a),r):r},init:function(a){if(f(a))for(var c in a)d[c]=a[c];var e=parseInt(d.id,10);return e&&(/qq\.com$/gi.test(location.hostname)&&(d.url||(d.url="//badjs2.qq.com/badjs"),d.uin||(d.uin=parseInt((document.cookie.match(/\buin=\D+(\d+)/)||[])[1],10))),d.report=(d.url||"/badjs")+"?id="+e+"&uin="+d.uin+"&from="+encodeURIComponent(location.href)+"&"),b.length&&q(),r},__onerror__:a.onerror};return"undefined"!=typeof console&&console.error&&setTimeout(function(){var a=((location.hash||"").match(/([#&])BJ_ERROR=([^&$]+)/)||[])[2];a&&console.error("BJ_ERROR",decodeURIComponent(a).replace(/(:\d+:\d+)\s*/g,"$1\n"))},0),r}(window);"undefined"!=typeof module&&(module.exports=BJ_REPORT),function(a){if(!a.BJ_REPORT)return void console.error("please load bg-report first");var b=function(b){a.BJ_REPORT.push(b)},c={};a.BJ_REPORT.tryJs=function(a){return a&&(b=a),c};var d,e=function(a,b){for(var c in b)a[c]=b[c]},f=function(a){return"function"==typeof a},g=function(c,e){return function(){try{return c.apply(this,e||arguments)}catch(f){if(b(f),f.stack&&console&&console.error&&console.error("[BJ-REPORT]",f.stack),!d){var g=a.onerror;a.onerror=function(){},d=setTimeout(function(){a.onerror=g,d=null},50)}throw f}}},h=function(a){return function(){for(var b,c=[],d=0,e=arguments.length;e>d;d++)b=arguments[d],f(b)&&(b=g(b)),c.push(b);return a.apply(this,c)}},i=function(a){return function(b,c){if("string"==typeof b)try{b=new Function(b)}catch(d){throw d}var e=[].slice.call(arguments,2);return b=g(b,e.length&&e),a(b,c)}},j=function(a,b){return function(){for(var c,d,e=[],h=0,i=arguments.length;i>h;h++)c=arguments[h],f(c)&&(d=g(c))&&(c.tryWrap=d)&&(c=d),e.push(c);return a.apply(b||this,e)}},k=function(a){var b,c;for(b in a)c=a[b],f(c)&&(a[b]=g(c));return a};c.spyJquery=function(){var b=a.$;if(!b||!b.event)return c;var d,e;b.zepto?(d=b.fn.on,e=b.fn.off,b.fn.on=j(d),b.fn.off=function(){for(var a,b=[],c=0,d=arguments.length;d>c;c++)a=arguments[c],f(a)&&a.tryWrap&&(a=a.tryWrap),b.push(a);return e.apply(this,b)}):window.jQuery&&(d=b.event.add,e=b.event.remove,b.event.add=j(d),b.event.remove=function(){for(var a,b=[],c=0,d=arguments.length;d>c;c++)a=arguments[c],f(a)&&a.tryWrap&&(a=a.tryWrap),b.push(a);return e.apply(this,b)});var g=b.ajax;return g&&(b.ajax=function(a,c){return c||(c=a,a=void 0),k(c),a?g.call(b,a,c):g.call(b,c)}),c},c.spyModules=function(){var b=a.require,d=a.define;return d&&d.amd&&b&&(a.require=h(b),e(a.require,b),a.define=h(d),e(a.define,d)),a.seajs&&d&&(a.define=function(){for(var a,b=[],c=0,e=arguments.length;e>c;c++)a=arguments[c],f(a)&&(a=g(a),a.toString=function(a){return function(){return a.toString()}}(arguments[c])),b.push(a);return d.apply(this,b)},a.seajs.use=h(a.seajs.use),e(a.define,d)),c},c.spySystem=function(){return a.setTimeout=i(a.setTimeout),a.setInterval=i(a.setInterval),c},c.spyCustom=function(a){return f(a)?g(a):k(a)},c.spyAll=function(){return c.spyJquery().spyModules().spySystem(),c}}(window);